---
title: "Go + GraphQLでPullRequestを表示するCLIツールを自作してみた"
emoji: "🍣"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Golang", "GraphQL", "GitHub"]
published: false
---

## 作ったもの
自分が作成した**OPENなプルリクエストをブラウザで表示**してくれます。
勤務を開始する前に**プルリクエストを全て表示**しているのですが、毎回**手動で**GitHubを操作するのが面倒だったのが、このCLIツールを作ったきっかけです。

`prs-go`が動いている様子を動画で切り抜く
:::message
そもそもリポジトリ名を載せてもいいのか、URLは大丈夫なのか、最新の注意を払う
:::

ソースコードはこちら
https://github.com/ReoYabiku/prs-go

## この記事でわかること
この記事では、以下のテーマを扱っています。
- **GitHub GraphQL API**の使い方
- Goのパッケージ、**cobra**の使い方
- Goのソースコードを**バイナリ化**して、任意のディレクトリから実行する方法

## CLIツールの構成
下記のポイントを図解する
- ターミナルをインターフェースとして利用している
- Goで作ったバイナリを作成した
  - cobraでコマンドオプションを受け付ける
  - GraphQLクライアントを作成してエンドポイントを叩く
- GraphQLを使ってGitHubから情報を取得する

## GitHub GraphQL APIの使い方

### そもそもGraphQLって何？

### アクセストークンの取得方法
- GitHubのトークン取得画面を貼付する

### このCLIに関係のあるスキーマ情報
- Postmanでアクセスしている様子を貼付する
:::message
organization名、レスポンスの諸情報の公開には最新の注意を払う
:::

## GoでGraphQLクライアントを作成する

### (クライアントに利用したリポジトリの名前)
構造体とタグを用いて、**直感的に**クエリを生成することができます。

```graphql
query {
}
```

```go
// 構造体でクエリを作成している様子
```

しかし、**変数を直接タグの値とすることができない**ので、`refrect`パッケージを用いてタグの中に埋め込む必要があります。

```go
// タグに変数の内容を書き込んでいる様子
```

## リポジトリの所有者をオプションで指定する
CLIの作成には、`cobra`を利用しました。ファイルの階層構造でサブコマンドを定義することができ、〇〇でオプションとその値を受け取ることができます。

https://hogehoge.com

### --owner オプションを作成する
このCLIツールは、**業務開始前に作業中のプルリクエストを一覧する**ことを目的としています。
そのため、今回は**リポジトリの所有者**でプルリクエストを絞り込む機能のみを実装しました。

```go
// オプションを設定する
```

### 動作確認
リポジトリの所有者を`--owner`オプションで指定することで、**その配下にある自作のプルリクエストをブラウザで表示**できるようになりました。

```shell
$ go run main.go --owner ReoYabiku
you have 3 pull requests!!
```

## バイナリをインストールする
毎回の勤務でプルリクエストを手動表示したくないというのはもちろん、**「自分でコマンドを作った感」** も同様に大切です。
`go run main.go`だと味気ないので、`prs-go`で実行できるようにしましょう。この`prs-go`というのは、`go mod init`時に指定したパッケージ名です。

```shell
$ go install prs-go
```

こうすることで、`$GOROOT/bin`にバイナリファイルが生成されます。つまり、`prs-go`という名前で**任意のディレクトリから**このコマンドを実行できるようになります。

```shell
$ ls $(go env GOPATH)/bin
prs-go*

$ prs-go --owner ReoYabiku
you have 3 pull requests!!
```
